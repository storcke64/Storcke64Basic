' Gambas class file

Inherits TextHighlighter

Public Const Name As String = "diff"
Public Const FullName As String = "Diff"
Public Const _Styles As String = "File,Header,Position,Added,Removed"

Public Sub Run(sText As String)
  
  Dim iState As Short
  Dim nSpace As Integer
  
  TextHighlighter.Limit = False
  
  If sText Like "index:*" Or If sText Begins "diff" Then
    iState = State.Header
    TextHighlighter.Limit = True
  Else If sText Begins "===" Then
    iState = State.Header
  Else If sText Begins "+++" Then
    iState = State.File
  Else If sText Begins "---" Then 
    iState = State.File
  Else If sText Begins "+" Then
    TextHighlighter.Add(State.Normal, 1)
    sText = Mid$(sText, 2)
    iState = State.Added
  Else If sText Begins "-" Then
    TextHighlighter.Add(State.Normal, 1)
    sText = Mid$(sText, 2)
    nSpace = Len(sText) - Len(LTrim(sText))
    If nSpace Then 
      TextHighlighter.Add(State.Normal, nSpace)
      sText = LTrim(sText)
    Endif
    iState = State.Removed
  Else If sText Begins "@" Then
    iState = State.Position
    TextHighlighter.Limit = True
  Else
    iState = State.Normal
  Endif

  TextHighlighter.Add(iState, String.Len(sText))
  
End
